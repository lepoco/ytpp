/*!
 * YTPP v1.0.0 (https://github.com/rapiddev/ytpp)
 * Copyright 2011-2020 The RapidDev | Leszek Pomianowski (https://rdev.cc/)
 * Licensed under MPL-2.0 (https://github.com/rapiddev/ytpp/blob/main/LICENSE)
 */
class YTPP{constructor(t=null){null!=t&&(this._version="1.0.0",this._yturl="https://www.googleapis.com/youtube/v3/",t.hasOwnProperty("container")?this._containers=t.container:this._containers=null,t.hasOwnProperty("api")?this._apiKey=t.api:this._apiKey="",t.hasOwnProperty("playlist")?this._playlist=t.playlist:this._playlist="",t.hasOwnProperty("debug")?this._debug=t.debug:this._debug=!1,t.hasOwnProperty("loop")?this._loop=t.loop:this._loop=!1,t.hasOwnProperty("format")?this._format=t.format:this._format="16by9",t.hasOwnProperty("rounded")?this._rounded=t.rounded:this._rounded=!0,t.hasOwnProperty("autoplay")?this._autoplay=t.autoplay:this._autoplay=!1,t.hasOwnProperty("playnext")?this._playnext=t.playnext:this._playnext=!0,t.hasOwnProperty("itemsWidth")?this._itemsWidth=t.itemsWidth:this._itemsWidth=110,t.hasOwnProperty("itemsHeight")?this._itemsHeight=t.itemsHeight:this._itemsHeight=70,t.hasOwnProperty("show")&&(t.show.hasOwnProperty("controls")?this._showControls=t.show.controls:this._showControls=!1,t.show.hasOwnProperty("titles")?this._showTitles=t.show.titles:this._showTitles=!1,t.show.hasOwnProperty("info")?this._showInfo=t.show.info:this._showInfo=!1,t.show.hasOwnProperty("related")?this._showRelated=t.show.related:this._showRelated=!1),this._debug&&(console.log("================\n YouTube Player\n================\nhttps://rdev.cc/\nv."+this._version),YTPP.ConsoleWrite("Debug mode enabled"),YTPP.ConsoleWrite("Loaded configuration","#fff",t),""!=this._playlist&&YTPP.ConsoleWrite("Playlist:","#fff",this._playlist),""!=this._apiKey&&YTPP.ConsoleWrite("API Key:","#fff",this._apiKey)))}Show(){let t,e=!1;if(""==this._containers||null==this._containers){if(t=document.getElementsByClassName("ytpp-player"),null==t)return void(this._debug&&YTPP.ConsoleWrite("Elements with class .ytpp-player do not exist!","red"))}else if("string"==typeof this._containers||this._containers instanceof String)if(this._containers.startsWith(".")){if(t=document.getElementsByClassName(this._containers.substring(1)),null==t)return void(this._debug&&YTPP.ConsoleWrite("Elements with class "+this._containers+" do not exist!","red"))}else{if(!this._containers.startsWith("#"))return void(this._debug&&YTPP.ConsoleWrite("An error occurred while finding the element/s. Only classes and IDs are available.","red"));if(t=document.getElementById(this._containers.substring(1)),e=!0,null==t)return void(this._debug&&YTPP.ConsoleWrite("Element with identifier "+this._containers+" does not exist!","red"))}else if(this._containers instanceof HTMLCollection)t=this._containers;else{if(!(this._containers instanceof HTMLElement))return void(this._debug&&YTPP.ConsoleWrite("An error occurred while finding the element/s. Only HTMLCollection's and HTMLElement's are available.","red"));t=this._containers,e=!0}if(e)this._containers=[t];else{this._containers=[];for(let e=0;e<t.length;e++)this._containers[e]=t[e]}this.LoadElements()}LoadElements(){this._debug&&YTPP.ConsoleWrite("Loading YouTube iFrame API");let t=this,e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";let s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(e,s),window.onYouTubeIframeAPIReady=function(){t.IsDebug()&&YTPP.ConsoleWrite("YouTube iFrame API loaded!"),t.BuildPlayers()}}BuildPlayers(){this._debug&&YTPP.ConsoleWrite("Players detected:","#fff",this._containers.length);let t={};for(let e=0;e<this._containers.length;e++)t={id:e,container:this._containers[e],api:this._containers[e].dataset.hasOwnProperty("api")?this._containers[e].dataset.api:this._apiKey,playlist:this._containers[e].dataset.hasOwnProperty("playlist")?this._containers[e].dataset.playlist:this._playlist,autoplay:this._containers[e].dataset.hasOwnProperty("autoplay")?YTPP.ParseTrue(this._containers[e].dataset.autoplay):this._autoplay,playnext:this._containers[e].dataset.hasOwnProperty("playnext")?YTPP.ParseTrue(this._containers[e].dataset.playnext):this._playnext,format:this._containers[e].dataset.hasOwnProperty("format")?this._containers[e].dataset.format:this._format,loop:this._containers[e].dataset.hasOwnProperty("loop")?this._containers[e].dataset.loop:this._loop,rounded:this._containers[e].dataset.hasOwnProperty("rounded")?YTPP.ParseTrue(this._containers[e].dataset.rounded):this._rounded,itemswidth:this._containers[e].dataset.hasOwnProperty("itemswidth")?this._containers[e].dataset.itemswidth:this._itemsWidth,itemsheight:this._containers[e].dataset.hasOwnProperty("itemsheight")?this._containers[e].dataset.itemsheight:this._itemsHeight,show:{controls:this._containers[e].dataset.hasOwnProperty("showcontrols")?YTPP.ParseTrue(this._containers[e].dataset.showcontrols):this._showControls,titles:this._containers[e].dataset.hasOwnProperty("showtitles")?YTPP.ParseTrue(this._containers[e].dataset.showtitles):this._showTitles,info:this._containers[e].dataset.hasOwnProperty("showinfo")?YTPP.ParseTrue(this._containers[e].dataset.showinfo):this._showInfo,related:this._containers[e].dataset.hasOwnProperty("showrelated")?YTPP.ParseTrue(this._containers[e].dataset.showrelated):this._showRelated},videos:[]},console.log(t),this.GetVideos(t)}GetVideos(t){if(""==t.playlist||null==t.playlist)return void(this._debug&&YTPP.ConsoleWrite("Playlist was not provided for container #"+t.id,"red"));let e=this._debug,s=new XMLHttpRequest;s.onreadystatechange=function(){if(s.readyState==XMLHttpRequest.DONE)if(200==s.status){if(/^[\],:{}\s]*$/.test(s.responseText.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){let i=JSON.parse(s.responseText);if(i.hasOwnProperty("items")){for(let e=0;e<i.items.length;e++)t.videos[e]={id:i.items[e].snippet.resourceId.videoId,title:i.items[e].snippet.title,description:i.items[e].snippet.description,publishedAt:i.items[e].snippet.publishedAt,thumbnail:i.items[e].snippet.thumbnails.default.url};YTPP.CreateIframe(t)}else e&&YTPP.ConsoleWrite("Connection to YouTube has been successfully established. But the downloaded list does not include videos.")}}else 400==s.status?e&&YTPP.ConsoleWrite("Error 400 received while downloading the video list."):e&&YTPP.ConsoleWrite("There was an error when getting the video list. Check the correctness of the configuration.")},s.open("GET",this._yturl+"playlistItems?playlistId="+t.playlist+"&key="+t.api+"&fields=items&part=snippet&maxResults=50",!0),s.send()}static CreateIframe(t){let e=document.createElement("div");e.classList.add("ytpp-frame"),"2by1"==t.format?e.classList.add("ytpp-v2by1"):"21by9"==t.format?e.classList.add("ytpp-v21by9"):e.classList.add("ytpp-v16by9"),t.rounded&&e.classList.add("ytpp-frame__rounded");let s=document.createElement("div");s.classList.add("embed-responsive-item"),s.style.position="absolute",s.style.top=0,s.style.left=0,s.style.width="100%",s.style.height="100%",s.style.border="none",e.appendChild(s),t.container.appendChild(e),t.player=new YT.Player(s,{videoId:t.videos[0].id,playerVars:{html5:1,fs:0,playsinline:1,modestbranding:1,list:t.playlist,loop:t.loop?1:0,showinfo:t.showInfo?1:0,autoplay:t.autoplay?1:0,rel:t.showRelated?1:0,controls:t.showControls?1:0},events:{onReady:function(t){console.log(t)},onStateChange:function(t){console.log(t)}}}),YTPP.CreateCarousel(t)}static CreateCarousel(t){let e=t.player,s=document.createElement("div");s.classList.add("ytpp-carousel"),s.style.height=t.itemsheight+"px";let i=document.createElement("div");i.classList.add("ytpp-carousel-track");let o,n=document.createElement("div");n.classList.add("ytpp-carousel-strip");for(let s=0;s<t.videos.length;s++){o=document.createElement("div"),o.classList.add("ytpp-playlist-"+s),o.classList.add("ytpp-item"),o.style.width=t.itemswidth+"px",t.rounded&&o.classList.add("ytpp-item__rounded"),o.dataset.id=t.videos[s].id,o.onclick=function(){let t=document.getElementsByClassName("ytpp-item active");for(;t.length>0;)t[0].classList.remove("active");this.classList.add("active"),e.loadVideoById({videoId:this.dataset.id})},0==s&&o.classList.add("active");let i=document.createElement("img");if(i.src=t.videos[s].thumbnail,o.appendChild(i),t.show.title){let e=document.createElement("p");e.innerHTML=t.videos[s].title,o.appendChild(e)}n.appendChild(o)}i.appendChild(n),s.appendChild(i),t.container.appendChild(s);let a=0;s.addEventListener("wheel",function(e){if(n.clientWidth<s.clientWidth)return;e.preventDefault();let o=-(t.videos.length*t.itemswidth-t.container.clientWidth),r=parseInt(e.deltaY);a-=r,o>a?(i.style.transform="translateX("+o+"px)",a=o):a>0?(i.style.transform="translateX(0px)",a=0):i.style.transform="translateX("+a+"px)"}),i.style.width="calc("+t.itemswidth+"px * "+t.videos.length+")"}IsDebug(){return this._debug}static ParseTrue(t){return 1==t||"true"==t||1==t||"1"==t||t>0}static ConsoleWrite(t,e="#fff",s=null){null!=s?console.log("%cYTPP: %c"+t,"color:#dc3545;font-weight: bold;","color: "+e,s):console.log("%cYTPP: %c"+t,"color:#dc3545;font-weight: bold;","color: "+e)}}